project(SGDNN CXX)

if(ENABLE_PYBIND)
  add_subdirectory(${PROJECT_ROOT}/third_party/pybind11 ${CMAKE_CURRENT_SOURCE_DIR})
endif()

if(SOC_MODE)
  set(CMAKE_C_COMPILER $ENV{CROSS_TOOLCHAINS}/gcc-arm-10.3-2021.07-x86_64-aarch64-none-linux-gnu/bin/aarch64-none-linux-gnu-gcc)
  set(CMAKE_ASM_COMPILER aarch64-linux-gnu-gcc)
  set(CMAKE_CXX_COMPILER aarch64-linux-gnu-g++)
endif()

include_directories(${PROJECT_ROOT}/third_party/flatbuffers/include)
link_directories(${PROJECT_ROOT}/third_party/flatbuffers/lib)
include_directories(${CMAKE_CURRENT_SOURCE_DIR}/include)
include_directories(${PROJECT_ROOT}/common/include)
include_directories(${PROJECT_ROOT}/bmodel/include)
include_directories(/opt/sophon/libsophon-current/include)
include_directories(${CMAKE_BINARY_DIR}/firmware_core)
link_directories(${PROJECT_ROOT}/build/bmodel/src)

if(USING_CMODEL)
  link_directories(${PROJECT_ROOT}/third_party)
else()
  link_directories(/opt/sophon/libsophon-current/lib)
endif()

add_library(sgdnn SHARED ${CMAKE_CURRENT_SOURCE_DIR}/src/sgdnn.cpp)
if(USING_CMODEL)
  target_link_libraries(sgdnn bmlib_cmodel)
else()
  target_link_libraries(sgdnn bmlib)
endif()

if (ENABLE_PYBIND)
  pybind11_add_module(sgdnn_pybind ${CMAKE_CURRENT_SOURCE_DIR}/src/sgdnn_pybind.cpp)
  if(USING_CMODEL)
    target_link_libraries(sgdnn_pybind sgdnn bmodel bmlib_cmodel)
  else()
    target_link_libraries(sgdnn_pybind sgdnn bmodel bmlib)
  endif()
endif()
