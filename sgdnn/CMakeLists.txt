project(SGDNN CXX)

if(ENABLE_PYBIND)
  add_subdirectory(${PROJECT_ROOT}/third_party/pybind11 ${CMAKE_CURRENT_SOURCE_DIR})
endif()

if(SOC_MODE)
  include(${PROJECT_ROOT}/toolchain-device.cmake)
else()
  include(${PROJECT_ROOT}/toolchain-cmodel.cmake)
endif()

include_directories(${CMAKE_CURRENT_SOURCE_DIR}/include)
include_directories(${PROJECT_ROOT}/common/include)
include_directories(/opt/sophon/libsophon-current/include)

link_directories(${PROJECT_ROOT}/third_party)
link_directories(/opt/sophon/libsophon-current/lib)

if(ENABLE_PYBIND)
  pybind11_add_module(sgdnn_pybind ${CMAKE_CURRENT_SOURCE_DIR}/src/sgdnn.cpp)
else()
  add_library(sgdnn SHARED ${CMAKE_CURRENT_SOURCE_DIR}/src/sgdnn.cpp)
endif()

if(USING_CMODEL)
  if(ENABLE_PYBIND)
    target_link_libraries(sgdnn_pybind bmlib_cmodel)
  else()
    target_link_libraries(sgdnn bmlib_cmodel)
  endif()
else()
  if(ENABLE_PYBIND)
    target_link_libraries(sgdnn_pybind bmlib)
  else()
    target_link_libraries(sgdnn bmlib)
  endif()
endif()
